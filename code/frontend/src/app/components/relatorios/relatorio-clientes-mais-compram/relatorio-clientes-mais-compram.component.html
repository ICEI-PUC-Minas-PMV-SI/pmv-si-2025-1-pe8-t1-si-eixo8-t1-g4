<body>
  <div class="box-title-page">
    <div>
      <h1 class="title-page">Ranking de Clientes que Mais Compram</h1>
    </div>
    <div class="box-buttons">
      <mat-icon (click)="fecharDialog()" class="icon-close">close</mat-icon>
    </div>
  </div>

  <mat-accordion>
    <mat-expansion-panel
      (opened)="buscarRankingMensal()"
      class="mat-expansion-panel-clientes"
    >
      <mat-expansion-panel-header class="mat-expansion-panel-header-clientes">
        <mat-panel-title>
          <span> Mês Atual </span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div>
        <table mat-table [dataSource]="clientesMensal">
          <ng-container matColumnDef="index">
            <th mat-header-cell *matHeaderCellDef>#</th>
            <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
          </ng-container>

          <ng-container matColumnDef="nomeCliente">
            <th mat-header-cell *matHeaderCellDef>Cliente</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.nomeCliente }}
            </td>
          </ng-container>

          <ng-container matColumnDef="valorComprado">
            <th mat-header-cell *matHeaderCellDef>Valor Comprado</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.valorComprado | currency : "BRL" }}
            </td>
          </ng-container>
          <ng-container matColumnDef="acoes">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let cliente">
              <div class="box-buttons-acoes">
                <mat-icon
                  (click)="
                    redirectToVisualizacaoCliente(
                      'cliente/visualizacao',
                      cliente.idCliente
                    )
                  "
                  matTooltip="Visualizar"
                  matTooltipPosition="below"
                  >remove_red_eye</mat-icon
                >
                @if(cliente.celularCliente) {
                <mat-icon
                  svgIcon="whatsapp"
                  (click)="
                    utilService.redirectToWhatsApp(cliente.celularCliente)
                  "
                  matTooltip="WhatApp"
                  matTooltipPosition="below"
                  class="icon-whatsapp"
                ></mat-icon>
                }
              </div>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="[
              'index',
              'nomeCliente',
              'valorComprado',
              'acoes'
            ]"
          ></tr>
          <tr
            mat-row
            *matRowDef="
              let row;
              columns: ['index', 'nomeCliente', 'valorComprado', 'acoes']
            "
          ></tr>
        </table>

        <button
          mat-raised-button
          color="primary"
          *ngIf="!mostrarTodosMensal"
          (click)="expandirRankingMensal()"
          class="button-expandir-ranking"
        >
          Expandir Ranking
        </button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-accordion>
    <mat-expansion-panel
      (opened)="buscarRankingAnual()"
      class="mat-expansion-panel-clientes"
    >
      <mat-expansion-panel-header class="mat-expansion-panel-header-clientes">
        <mat-panel-title>
          <span> Ano Atual </span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div>
        <table mat-table [dataSource]="clientesAnual">
          <ng-container matColumnDef="index">
            <th mat-header-cell *matHeaderCellDef>#</th>
            <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
          </ng-container>

          <ng-container matColumnDef="nomeCliente">
            <th mat-header-cell *matHeaderCellDef>Cliente</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.nomeCliente }}
            </td>
          </ng-container>

          <ng-container matColumnDef="valorComprado">
            <th mat-header-cell *matHeaderCellDef>Valor Comprado</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.valorComprado | currency : "BRL" }}
            </td>
          </ng-container>

          <ng-container matColumnDef="acoes">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let cliente">
              <div class="box-buttons-acoes">
                <mat-icon
                  (click)="
                    redirectToVisualizacaoCliente(
                      'cliente/visualizacao',
                      cliente.idCliente
                    )
                  "
                  matTooltip="Visualizar"
                  matTooltipPosition="below"
                  >remove_red_eye</mat-icon
                >
                @if(cliente.celularCliente) {
                <mat-icon
                  svgIcon="whatsapp"
                  (click)="
                    utilService.redirectToWhatsApp(cliente.celularCliente)
                  "
                  matTooltip="WhatApp"
                  matTooltipPosition="below"
                  class="icon-whatsapp"
                ></mat-icon>
                }
              </div>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="[
              'index',
              'nomeCliente',
              'valorComprado',
              'acoes'
            ]"
          ></tr>
          <tr
            mat-row
            *matRowDef="
              let row;
              columns: ['index', 'nomeCliente', 'valorComprado', 'acoes']
            "
          ></tr>
        </table>

        <button
          mat-raised-button
          color="primary"
          *ngIf="!mostrarTodosAnual"
          (click)="expandirRankingAnual()"
          class="button-expandir-ranking"
        >
          Expandir Ranking
        </button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-accordion>
    <mat-expansion-panel
      (opened)="buscarRankingGeral()"
      class="mat-expansion-panel-clientes"
    >
      <mat-expansion-panel-header class="mat-expansion-panel-header-clientes">
        <mat-panel-title>
          <span> Todo o Período </span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div>
        <table mat-table [dataSource]="clientesGeral">
          <ng-container matColumnDef="index">
            <th mat-header-cell *matHeaderCellDef>#</th>
            <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
          </ng-container>

          <ng-container matColumnDef="nomeCliente">
            <th mat-header-cell *matHeaderCellDef>Cliente</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.nomeCliente }}
            </td>
          </ng-container>

          <ng-container matColumnDef="valorComprado">
            <th mat-header-cell *matHeaderCellDef>Valor Comprado</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.valorComprado | currency : "BRL" }}
            </td>
          </ng-container>

          <ng-container matColumnDef="acoes">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let cliente">
              <div class="box-buttons-acoes">
                <mat-icon
                  (click)="
                    redirectToVisualizacaoCliente(
                      'cliente/visualizacao',
                      cliente.idCliente
                    )
                  "
                  matTooltip="Visualizar"
                  matTooltipPosition="below"
                  >remove_red_eye</mat-icon
                >
                @if(cliente.celularCliente) {
                <mat-icon
                  svgIcon="whatsapp"
                  (click)="
                    utilService.redirectToWhatsApp(cliente.celularCliente)
                  "
                  matTooltip="WhatApp"
                  matTooltipPosition="below"
                  class="icon-whatsapp"
                ></mat-icon>
                }
              </div>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="[
              'index',
              'nomeCliente',
              'valorComprado',
              'acoes'
            ]"
          ></tr>
          <tr
            mat-row
            *matRowDef="
              let row;
              columns: ['index', 'nomeCliente', 'valorComprado', 'acoes']
            "
          ></tr>
        </table>

        <button
          mat-raised-button
          color="primary"
          *ngIf="!mostrarTodosGeral"
          (click)="expandirRankingGeral()"
          class="button-expandir-ranking"
        >
          Expandir Ranking
        </button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</body>